# Changes

Code differences compared to source project demokratos.

## internal/biz/greeter_test.go (+45 -0)

```diff
@@ -0,0 +1,45 @@
+package biz_test
+
+import (
+	"context"
+	"os"
+	"path/filepath"
+	"testing"
+
+	"github.com/go-kratos/kratos/v2/log"
+	"github.com/orzkratos/demokratos/demo1kratos"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/biz"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/biz/wirebiz"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/pkg/cfgdata"
+	"github.com/stretchr/testify/require"
+	"github.com/yyle88/must"
+	"github.com/yyle88/neatjson/neatjsons"
+	"github.com/yyle88/osexistpath/osmustexist"
+	"github.com/yyle88/zaplog"
+	"go.uber.org/zap"
+)
+
+var caseWireBox *wirebiz.WireBox
+
+func TestMain(m *testing.M) {
+	configPath := osmustexist.ROOT(filepath.Join(demo1kratos.SourceRoot(), "configs"))
+	zaplog.LOG.Debug("run-test-main", zap.String("config-path", configPath))
+
+	cfg := cfgdata.ParseConfig(configPath)
+	wireBox, cleanup, err := wirebiz.NewWireBox(cfg.Data, log.NewStdLogger(os.Stdout))
+	must.Done(err)
+	defer cleanup()
+
+	caseWireBox = wireBox
+	zaplog.LOG.Debug("run-test-main")
+	m.Run()
+}
+
+func TestGreeterUsecase_CreateGreeter(t *testing.T) {
+	res, err := caseWireBox.GreeterUsecase.CreateGreeter(context.Background(), &biz.Greeter{
+		Hello: "abc",
+	})
+	require.NoError(t, err)
+	t.Log(neatjsons.S(res))
+	require.Equal(t, "abc", res.Hello)
+}
```

## internal/biz/wirebiz/wire.go (+24 -0)

```diff
@@ -0,0 +1,24 @@
+//go:build wireinject
+
+// The build tag makes sure the stub is not built in the final build.
+
+package wirebiz
+
+import (
+	"github.com/go-kratos/kratos/v2/log"
+	"github.com/google/wire"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/biz"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/conf"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/data"
+)
+
+// wireApp init kratos application.
+func wireApp(*conf.Data, log.Logger) (*WireBox, func(), error) {
+	panic(wire.Build(
+		// server.ProviderSet, // unused provider set "ProviderSet" //需要把没有用到的注释掉
+		data.ProviderSet,
+		biz.ProviderSet,
+		//service.ProviderSet,
+		newWireBox,
+	))
+}
```

## internal/biz/wirebiz/wire_box.go (+21 -0)

```diff
@@ -0,0 +1,21 @@
+package wirebiz
+
+import (
+	"github.com/go-kratos/kratos/v2/log"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/biz"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/conf"
+)
+
+type WireBox struct {
+	GreeterUsecase *biz.GreeterUsecase
+}
+
+func newWireBox(greeterUsecase *biz.GreeterUsecase) *WireBox {
+	return &WireBox{
+		GreeterUsecase: greeterUsecase,
+	}
+}
+
+func NewWireBox(confData *conf.Data, logger log.Logger) (*WireBox, func(), error) {
+	return wireApp(confData, logger)
+}
```

## internal/biz/wirebiz/wire_gen.go (+30 -0)

```diff
@@ -0,0 +1,30 @@
+// Code generated by Wire. DO NOT EDIT.
+
+//go:generate go run -mod=mod github.com/google/wire/cmd/wire
+//go:build !wireinject
+// +build !wireinject
+
+package wirebiz
+
+import (
+	"github.com/go-kratos/kratos/v2/log"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/biz"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/conf"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/data"
+)
+
+// Injectors from wire.go:
+
+// wireApp init kratos application.
+func wireApp(confData *conf.Data, logger log.Logger) (*WireBox, func(), error) {
+	dataData, cleanup, err := data.NewData(confData, logger)
+	if err != nil {
+		return nil, nil, err
+	}
+	greeterRepo := data.NewGreeterRepo(dataData, logger)
+	greeterUsecase := biz.NewGreeterUsecase(greeterRepo, logger)
+	wireBox := newWireBox(greeterUsecase)
+	return wireBox, func() {
+		cleanup()
+	}, nil
+}
```

## internal/data/greeter_test.go (+54 -0)

```diff
@@ -0,0 +1,54 @@
+package data_test
+
+import (
+	"context"
+	"os"
+	"path/filepath"
+	"testing"
+
+	"github.com/go-kratos/kratos/v2/log"
+	"github.com/orzkratos/demokratos/demo1kratos"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/biz"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/data/wiredata"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/pkg/cfgdata"
+	"github.com/stretchr/testify/require"
+	"github.com/yyle88/must"
+	"github.com/yyle88/neatjson/neatjsons"
+	"github.com/yyle88/osexistpath/osmustexist"
+	"github.com/yyle88/zaplog"
+	"go.uber.org/zap"
+)
+
+var caseWireBox *wiredata.WireBox
+
+func TestMain(m *testing.M) {
+	configPath := osmustexist.ROOT(filepath.Join(demo1kratos.SourceRoot(), "configs"))
+	zaplog.LOG.Debug("run-test-main", zap.String("config-path", configPath))
+
+	cfg := cfgdata.ParseConfig(configPath)
+	wireBox, cleanup, err := wiredata.NewWireBox(cfg.Data, log.NewStdLogger(os.Stdout))
+	must.Done(err)
+	defer cleanup()
+
+	caseWireBox = wireBox
+	zaplog.LOG.Debug("run-test-main")
+	m.Run()
+}
+
+func Test_greeterRepo_Save(t *testing.T) {
+	res, err := caseWireBox.GreeterRepo.Save(context.Background(), &biz.Greeter{
+		Hello: "xyz",
+	})
+	require.NoError(t, err)
+	t.Log(neatjsons.S(res))
+	require.Equal(t, "xyz", res.Hello)
+}
+
+func Test_greeterRepo_Update(t *testing.T) {
+	res, err := caseWireBox.GreeterRepo.Update(context.Background(), &biz.Greeter{
+		Hello: "uvw",
+	})
+	require.NoError(t, err)
+	t.Log(neatjsons.S(res))
+	require.Equal(t, "uvw", res.Hello)
+}
```

## internal/data/wiredata/wire.go (+23 -0)

```diff
@@ -0,0 +1,23 @@
+//go:build wireinject
+
+// The build tag makes sure the stub is not built in the final build.
+
+package wiredata
+
+import (
+	"github.com/go-kratos/kratos/v2/log"
+	"github.com/google/wire"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/conf"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/data"
+)
+
+// wireApp init kratos application.
+func wireApp(*conf.Data, log.Logger) (*WireBox, func(), error) {
+	panic(wire.Build(
+		// server.ProviderSet, // unused provider set "ProviderSet" //需要把没有用到的注释掉
+		data.ProviderSet,
+		//biz.ProviderSet,
+		//service.ProviderSet,
+		newWireBox,
+	))
+}
```

## internal/data/wiredata/wire_box.go (+21 -0)

```diff
@@ -0,0 +1,21 @@
+package wiredata
+
+import (
+	"github.com/go-kratos/kratos/v2/log"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/biz"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/conf"
+)
+
+type WireBox struct {
+	GreeterRepo biz.GreeterRepo
+}
+
+func newWireBox(greeterRepo biz.GreeterRepo) *WireBox {
+	return &WireBox{
+		GreeterRepo: greeterRepo,
+	}
+}
+
+func NewWireBox(confData *conf.Data, logger log.Logger) (*WireBox, func(), error) {
+	return wireApp(confData, logger)
+}
```

## internal/data/wiredata/wire_gen.go (+28 -0)

```diff
@@ -0,0 +1,28 @@
+// Code generated by Wire. DO NOT EDIT.
+
+//go:generate go run -mod=mod github.com/google/wire/cmd/wire
+//go:build !wireinject
+// +build !wireinject
+
+package wiredata
+
+import (
+	"github.com/go-kratos/kratos/v2/log"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/conf"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/data"
+)
+
+// Injectors from wire.go:
+
+// wireApp init kratos application.
+func wireApp(confData *conf.Data, logger log.Logger) (*WireBox, func(), error) {
+	dataData, cleanup, err := data.NewData(confData, logger)
+	if err != nil {
+		return nil, nil, err
+	}
+	greeterRepo := data.NewGreeterRepo(dataData, logger)
+	wireBox := newWireBox(greeterRepo)
+	return wireBox, func() {
+		cleanup()
+	}, nil
+}
```

## internal/pkg/cfgdata/cfg_data.go (+27 -0)

```diff
@@ -0,0 +1,27 @@
+package cfgdata
+
+import (
+	"github.com/go-kratos/kratos/v2/config"
+	"github.com/go-kratos/kratos/v2/config/file"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/conf"
+	"github.com/yyle88/rese"
+)
+
+func ParseConfig(configPath string) *conf.Bootstrap {
+	c := config.New(
+		config.WithSource(
+			file.NewSource(configPath),
+		),
+	)
+	defer rese.F0(c.Close)
+
+	if err := c.Load(); err != nil {
+		panic(err)
+	}
+
+	var cfg conf.Bootstrap
+	if err := c.Scan(&cfg); err != nil {
+		panic(err)
+	}
+	return &cfg
+}
```

## internal/service/greeter_test.go (+45 -0)

```diff
@@ -0,0 +1,45 @@
+package service_test
+
+import (
+	"context"
+	"os"
+	"path/filepath"
+	"testing"
+
+	"github.com/go-kratos/kratos/v2/log"
+	"github.com/orzkratos/demokratos/demo1kratos"
+	v1 "github.com/orzkratos/demokratos/demo1kratos/api/helloworld/v1"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/pkg/cfgdata"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/service/wireservice"
+	"github.com/stretchr/testify/require"
+	"github.com/yyle88/must"
+	"github.com/yyle88/neatjson/neatjsons"
+	"github.com/yyle88/osexistpath/osmustexist"
+	"github.com/yyle88/zaplog"
+	"go.uber.org/zap"
+)
+
+var caseWireBox *wireservice.WireBox
+
+func TestMain(m *testing.M) {
+	configPath := osmustexist.ROOT(filepath.Join(demo1kratos.SourceRoot(), "configs"))
+	zaplog.LOG.Debug("run-test-main", zap.String("config-path", configPath))
+
+	cfg := cfgdata.ParseConfig(configPath)
+	wireBox, cleanup, err := wireservice.NewWireBox(cfg.Data, log.NewStdLogger(os.Stdout))
+	must.Done(err)
+	defer cleanup()
+
+	caseWireBox = wireBox
+	zaplog.LOG.Debug("run-test-main")
+	m.Run()
+}
+
+func TestGreeterService_SayHello(t *testing.T) {
+	res, err := caseWireBox.GreeterService.SayHello(context.Background(), &v1.HelloRequest{
+		Name: "LUO-LUO",
+	})
+	require.NoError(t, err)
+	t.Log(neatjsons.S(res))
+	require.Equal(t, "Hello LUO-LUO", res.Message)
+}
```

## internal/service/wireservice/wire.go (+25 -0)

```diff
@@ -0,0 +1,25 @@
+//go:build wireinject
+
+// The build tag makes sure the stub is not built in the final build.
+
+package wireservice
+
+import (
+	"github.com/go-kratos/kratos/v2/log"
+	"github.com/google/wire"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/biz"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/conf"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/data"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/service"
+)
+
+// wireApp init kratos application.
+func wireApp(*conf.Data, log.Logger) (*WireBox, func(), error) {
+	panic(wire.Build(
+		// server.ProviderSet, // unused provider set "ProviderSet" //需要把没有用到的注释掉
+		data.ProviderSet,
+		biz.ProviderSet,
+		service.ProviderSet,
+		newWireBox,
+	))
+}
```

## internal/service/wireservice/wire_box.go (+21 -0)

```diff
@@ -0,0 +1,21 @@
+package wireservice
+
+import (
+	"github.com/go-kratos/kratos/v2/log"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/conf"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/service"
+)
+
+type WireBox struct {
+	GreeterService *service.GreeterService
+}
+
+func newWireBox(greeterService *service.GreeterService) *WireBox {
+	return &WireBox{
+		GreeterService: greeterService,
+	}
+}
+
+func NewWireBox(confData *conf.Data, logger log.Logger) (*WireBox, func(), error) {
+	return wireApp(confData, logger)
+}
```

## internal/service/wireservice/wire_gen.go (+32 -0)

```diff
@@ -0,0 +1,32 @@
+// Code generated by Wire. DO NOT EDIT.
+
+//go:generate go run -mod=mod github.com/google/wire/cmd/wire
+//go:build !wireinject
+// +build !wireinject
+
+package wireservice
+
+import (
+	"github.com/go-kratos/kratos/v2/log"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/biz"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/conf"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/data"
+	"github.com/orzkratos/demokratos/demo1kratos/internal/service"
+)
+
+// Injectors from wire.go:
+
+// wireApp init kratos application.
+func wireApp(confData *conf.Data, logger log.Logger) (*WireBox, func(), error) {
+	dataData, cleanup, err := data.NewData(confData, logger)
+	if err != nil {
+		return nil, nil, err
+	}
+	greeterRepo := data.NewGreeterRepo(dataData, logger)
+	greeterUsecase := biz.NewGreeterUsecase(greeterRepo, logger)
+	greeterService := service.NewGreeterService(greeterUsecase)
+	wireBox := newWireBox(greeterService)
+	return wireBox, func() {
+		cleanup()
+	}, nil
+}
```

